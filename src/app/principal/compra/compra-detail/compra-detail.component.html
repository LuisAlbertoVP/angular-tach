<div class="container mt-3">
  <div class="row p-3 shadow">
    <div class="d-flex tag">
      <div>
        <h2 class="blue">Compra</h2>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a [routerLink]="['/principal/compras']" class="blue">Compras</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ id ? 'Modificar Compra' : 'Nueva Compra' }}</li>
          </ol>
        </nav>
      </div>
      <div class="ml-auto">
        <img src="assets/logo.png" />
      </div>
    </div>
  </div>
  <div class="row p-3 shadow">
    <div class="mat-elevation-z8 table-container col-8">
      <table mat-table [dataSource]="data" class="w-100">
        <ng-container matColumnDef="codigo">
          <th mat-header-cell *matHeaderCellDef>Código</th>
          <td mat-cell *matCellDef="let row">{{ row.codigo }}</td>
        </ng-container>
        <ng-container matColumnDef="descripcion">
          <th mat-header-cell *matHeaderCellDef>Descripción</th>
          <td mat-cell *matCellDef="let row">{{ row.descripcion }}</td>
        </ng-container>
        <ng-container matColumnDef="stock">
          <th mat-header-cell *matHeaderCellDef>Cantidad</th>
          <td mat-cell *matCellDef="let row">{{ row.stock }}</td>
        </ng-container>
        <ng-container matColumnDef="precio">
          <th mat-header-cell *matHeaderCellDef>Precio</th>
          <td mat-cell *matCellDef="let row">{{ row.precio | currency }}</td>
        </ng-container>
        <ng-container matColumnDef="total">
          <th mat-header-cell *matHeaderCellDef>Total</th>
          <td mat-cell *matCellDef="let row">{{ (row.stock * row.precio) | currency }}</td>
        </ng-container>
        <ng-container matColumnDef="accion">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let row" (click)="$event.stopPropagation()">
            <a mat-icon-button color="accent" (click)="delete(row)"><mat-icon>delete</mat-icon></a></td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="openBusqueda(row)" class="element-row cursor-point"></tr>
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">Lista de compras vacía</td>
        </tr>
      </table>  
    </div>
    <form [formGroup]="form" (ngSubmit)="guardar()" class="col-4">
      <div class="d-flex">
        <button mat-icon-button color="primary" (click)="openBusqueda()" type="button"><mat-icon>add_shopping_cart</mat-icon></button>
        <button mat-icon-button color="primary" type="submit" class="ml-auto"><mat-icon>save</mat-icon></button>
      </div>
      <mat-divider></mat-divider>
      <ul class="mt-4 list-unstyled">
        <li class="d-flex"><span class="bold">Cantidad</span><span class="ml-auto">{{ cantidad }}</span></li>
        <li class="d-flex"><span class="bold">Total</span><span class="ml-auto">{{ total | currency }}</span></li>
      </ul>
      <mat-divider></mat-divider>
      <mat-form-field class="no-error mt-4" appearance="fill">
        <mat-label>Fecha</mat-label>
        <input matInput formControlName="fecha" [matDatepicker]="picker" required />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field class="no-error mt-2" appearance="outline">
        <mat-label>Detalles de compra</mat-label>
        <textarea matInput formControlName="descripcion" class="h-descripcion"></textarea>
      </mat-form-field>
    </form>
  </div>
</div>